#include "piece.h"

typedef struct {
  bool rotation[4][16];
  float color[3];

  float offset[2];

  // TODO: Switch to binary format => more efficient iteration (probably)
} PieceProperty;

static const PieceProperty
  PROPERTIES[PIECE_COUNT] =
    {
      [PIECE_I] =
        {
          .rotation =
            {
              {
                0, 0, 0, 0,  //
                1, 1, 1, 1,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 1, 0,  //
                0, 0, 1, 0,  //
                0, 0, 1, 0,  //
                0, 0, 1, 0,  //
              },
              {
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
                1, 1, 1, 1,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
              },
            },
          .color = {0.0, 0.79, 0.945},
          .offset = {0.0, 0.0},
        },
      [PIECE_O] =
        {
          .rotation =
            {
              {
                0, 1, 1, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 1, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 1, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 1, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
            },
          .color = {0.98, 0.83, 0.0},
          .offset = {0.0, 0.5},
        },
      [PIECE_T] =
        {
          .rotation =
            {
              {
                0, 1, 0, 0,  //
                1, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                0, 1, 1, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 0, 0,  //
                1, 1, 1, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                1, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
            },
          .color = {0.72, 0.26, 0.62},
          .offset = {0.5, 0.5},
        },
      [PIECE_S] =
        {
          .rotation =
            {
              {
                0, 1, 1, 0,  //
                1, 1, 0, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                0, 1, 1, 0,  //
                0, 0, 1, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 0, 0,  //
                0, 1, 1, 0,  //
                1, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                1, 0, 0, 0,  //
                1, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
            },
          .color = {0.0, 0.73, 0.23},
          .offset = {0.5, 0.5},
        },
      [PIECE_Z] =
        {
          .rotation =
            {
              {
                1, 1, 0, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 1, 0,  //
                0, 1, 1, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 0, 0,  //
                1, 1, 0, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                1, 1, 0, 0,  //
                1, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
            },
          .color = {1.0, 0.0, 0.13},
          .offset = {0.5, 0.5},
        },
      [PIECE_J] =
        {
          .rotation =
            {
              {
                1, 0, 0, 0,  //
                1, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 1, 0,  //
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 0, 0,  //
                1, 1, 1, 0,  //
                0, 0, 1, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
                1, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
            },
          .color = {0.36, 0.38, 0.68},
          .offset = {0.5, 0.5},
        },
      [PIECE_L] =
        {
          .rotation =
            {
              {
                0, 0, 1, 0,  //
                1, 1, 1, 0,  //
                0, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 1, 1, 0,  //
                0, 0, 0, 0,  //
              },
              {
                0, 0, 0, 0,  //
                1, 1, 1, 0,  //
                1, 0, 0, 0,  //
                0, 0, 0, 0,  //
              },
              {
                1, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 1, 0, 0,  //
                0, 0, 0, 0,  //
              },
            },
          .color = {0.98, 0.45, 0.03},
          .offset = {0.5, 0.5},
        },
};

const bool *FallingPieceGetRotation(FallingPiece *p) {
  return PROPERTIES[p->type].rotation[p->rotation];
}

const bool *PieceGetShape(Piece type) { return *PROPERTIES[type].rotation; }

const float *PieceGetColor(Piece type) { return PROPERTIES[type].color; }

const float *PieceGetOffset(Piece type) { return PROPERTIES[type].offset; }
